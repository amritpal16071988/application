#!groovy
pipeline {
agent {
  label 'ansible'
}
  parameters {
    string (name: 'app_version', description: 'Please enter the app_version')
  }  
  stages {  
    stage('Pre_validation') {
      steps {
        sh ''' 
          echo "checking application"
        '''
      }
    }
      stage('Build') {
        when {
          branch 'dev';
          allOf{
             branch 'qa' 
             expression { app_version ==~ /G.R.C./ }
          }
          beforeOptions true
        }
      steps {
        sh ''' 
          echo "building application"
        '''
      }
    }  
    stage('dev_Software_deployment') {
      when {
        branch 'dev'
        beforeOptions true
      }      
      steps {
        sh ''' 
          ansible --version
        '''
      }
    }
    stage('Sanity_check') {
      when {
        branch 'dev'
        beforeOptions true
      }      
      steps {
        sh ''' 
          ansible --version
        '''
      }
    }    
    stage('qa_Software_deployment') {
      when {
        branch 'qa'
        expression { app_version ==~ /G.R.C./ }
        beforeOptions true
      }      
      steps {
        sh ''' 
          ansible --version
        '''
      }
    } 
    stage('uat_Software_deployment') {
      when {
        branch 'uat'
        expression { app_version ==~ /G.R.C./ }
        beforeOptions true
      }      
      steps {
        sh ''' 
          ansible --version
        '''
      }
    }
    stage('prod_Software_deployment') {
      when {
        branch 'prod'
        expression { app_version ==~ /G.R.C./ }
        beforeOptions true
      }      
      steps {
        sh ''' 
          ansible --version
        '''
      }
    }           
  } 
  post {
    always {
      cleanWs()
    }
  }
}
